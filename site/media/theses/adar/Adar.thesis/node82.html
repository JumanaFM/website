<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>The HsArchive Service</TITLE>
<META NAME="description" CONTENT="The HsArchive Service">
<META NAME="keywords" CONTENT="main">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="main.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html1201" HREF="node83.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html1199" HREF="node81.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html1193" HREF="node81.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html1203" HREF="node2.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A>  <BR>
<B> Next:</B> <A NAME="tex2html1202" HREF="node83.html">The HsIndex Service</A>
<B>Up:</B> <A NAME="tex2html1200" HREF="node81.html">Data manipulation Services</A>
<B> Previous:</B> <A NAME="tex2html1194" HREF="node81.html">Data manipulation Services</A>
<BR> <P>
<H2><A NAME="SECTION001061000000000000000">The <tt>HsArchive</tt> Service</A></H2>
<A NAME="HsArchive">&#160;</A>
In order to intitially ``introduce'' documents into a user's Haystack
a basic service is necessary to create a kernel of an HDM subgraph.
From this kernel Haystack services can begin the process of assembling
a representation of the document in the HDM.  <tt>HsArchive</tt>
serves in this capacity by instantiating the ``kernel'' composed of a
<tt>bale.HaystackDocument</tt> and a <tt>needle.Location</tt>.
<P>
Once the <tt>bale.HaystackDocument</tt> and <tt>needle.Location</tt>
have been created, the event based service,
<tt>haystack.service.fetch.FetchService </tt>(or a more specialized
fetch service<A NAME="tex2html51" HREF="footnode.html#1989"><IMG  ALIGN=BOTTOM ALT="gif" SRC="foot_motif.gif"></A>) is informed of a new event in the
  HDM.  The service will subsequently try to retrieve the data being
  pointed at by the <tt>needle.Location</tt>.  When this data is
  obtained a
<tt>needle.Body</tt> is attached to the
<tt>bale.HaystackDocument</tt>.  Additionally, the
<tt>FetchService</tt> will also calculate the MD5 checksum and
generate a checksum needle to attach to the <tt>bale.HaystackDocument</tt>.
<P>
<tt>HsArchive</tt> is invoked with a variety of options that indicate
how the HDM cluster for the archived document should be constructed.
A document's uniquness is measured by two values: its location and its
checksum. <tt>HsArchive</tt> maintains two tables, one mapping
locations to <tt>needle.Location</tt> objects with that location, and
a table mapping checksums to the <tt>needle.Body</tt> objects that
produced the checksum value.  In invoking the <tt>archive(...)</tt>
method in <tt>HsArchive</tt>, a user may specify Haystack's behavior
in dealing with the four possible cases: location and checksum match,
one of the two matches (2 cases), and neither matches.  The user's
specification for archiving behavior for a specific document are
retained in a table.
<P>
After the <tt>FetchService</tt> obtains the object and makes the
appropriate connections, another event-driven service is invoked.
This service, the <tt>HsFileChecker</tt>, awaits the appearance of a
<tt>bale.HaystackDocument</tt> attached to a location and checksum.
The <tt>HsFileChecker</tt> will lookup the user specified archive
options described above.  It will also check to see if the location
and checksum are already in the <tt>HsArchive</tt>'s databases.  If
both the URL and checksum match, the implication is that the user
asked for the same document to be archived twice.  The default
behavior is to remove the new HDM cluster and abort.  However, the
user may specify that a new (duplicate) cluster be created.  The last
case (neither match) is simiarily trivial, as we know the object is
entirely new, the cluster is left alone and archiving continues.
<P>
If the location matched but the checksum did not, the implication is
that the document has changed.  The default behavior is to connect the
new <tt>needle.Body</tt> object to the old
<tt>bale.HaystackDocument</tt> and in effect supercede the previous
body.  Alternatively, a user may specify that the HDM cluster continue
to exist seperately.  Finally, if the checksum matched but the
location did not, one of two things may have happened, the document
was copied or the document was moved.  This is easily verifiable by
looking at the old location and determining if the document is still
there.  The options available to the user in this state would be to
merge, supercede, or abort the archive.
<P>
If the HDM cluster has survived the <tt>HsFileChecker</tt>, other
services may begin to act on it.  The <tt>HsTypeGuesser</tt> can
decide type type of the object and attach the appropriate
<tt>needle.Filetype</tt> object.  Once a type is guessed, field
finders and textifiers can start their work on the cluster.  A field
finder can parse through the <tt>needle.Body</tt> of a file, finding
relevant pieces of data corresponding to the document state previously
discussed.  Trivially, a <tt>HsMailFieldFinder</tt> service can extract
the <em>to</em>, <em>from</em>, <em>subject</em>, <em>date</em>, and <em>id</em>
lines for an e-mail document and generate the appropriate
<tt>needle.Mailfield</tt> objects.  Finally, a textifier service
specific to the type of document may extract the text form the
document.  This extraction does not need to be done immediately and
the textifier may leave a <tt>Promise</tt> in the <tt>needle.Text</tt>
object.  At the time of this writing services have been implemented to
extract text from Postscript and PDF files as well as some trivial
ascii based file formats.
<P>
<HR><A NAME="tex2html1201" HREF="node83.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html1199" HREF="node81.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html1193" HREF="node81.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html1203" HREF="node2.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A>  <BR>
<B> Next:</B> <A NAME="tex2html1202" HREF="node83.html">The HsIndex Service</A>
<B>Up:</B> <A NAME="tex2html1200" HREF="node81.html">Data manipulation Services</A>
<B> Previous:</B> <A NAME="tex2html1194" HREF="node81.html">Data manipulation Services</A>
<P><ADDRESS>
Copyright 1998, Eytan Adar (eytan@alum.mit.edu)
</ADDRESS>
</BODY>
</HTML>
