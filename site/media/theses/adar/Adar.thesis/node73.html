<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>The Middleman</TITLE>
<META NAME="description" CONTENT="The Middleman">
<META NAME="keywords" CONTENT="main">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="main.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html1104" HREF="node74.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html1102" HREF="node72.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html1096" HREF="node72.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html1106" HREF="node2.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A>  <BR>
<B> Next:</B> <A NAME="tex2html1105" HREF="node74.html">The HsCommandAPI Service</A>
<B>Up:</B> <A NAME="tex2html1103" HREF="node72.html">The Interface Services</A>
<B> Previous:</B> <A NAME="tex2html1097" HREF="node72.html">The Interface Services</A>
<BR> <P>
<H2><A NAME="SECTION001041000000000000000">The <tt>Middleman</tt></A></H2>
<A NAME="Middleman">&#160;</A>
This section provides a very basic introduction to communication
between two <tt>HaystackRootServer</tt>s.  The full
implementation details for the <tt>Middleman</tt> are available
in&nbsp;[<A HREF="node88.html#asdo">6</A>].
<P>
When initially selecting to work in Java it was necessary to decide
how inter-process communication was to work in Haystack.
Specifically, because Java processes run within the context of a
Virtual Machine (VM), some mechanism is needed for communicating
between processes running in seperate VMs.  For example, Haystack
specifies that a user always have one central
<tt>HaystackRootServer</tt>.  Perhaps this <tt>HaystackRootServer</tt>
is running on the user's computer at home.  If the user needs to query
his Haystack from work, it is necessary to be able to interact with
the main <tt>HaystackRootServer</tt> remotely.  Additionally, as
Haystack begins to support collaboration inter-VM communication will
become vital.
<P>
The <tt>Middleman</tt> technology facilitates this inter-VM
communication by implementing a form of remote procedure call (RPC).
Java provides a built in method called Remote Method Invocation (RMI)
for inter-VM communication.  However, this implementation was
evaluated to be two slow and complex for our purposes.  Additionally,
RMI is only provided in some implemenations of Java and may not be
used in the future.  Other solutions, such as CORBA and ILU [<A HREF="node88.html#ILU">24</A>]
were too complex for our needs.
<P>
In implementing Haystack we wanted to provide a very simplistic
mechanism for exporting the functions of one service so that a process
running in a seperate VM would be able to invoke these functions as if
they were in the local VM.
<P>
The general process for this communication model is fairly simple.
When implementing a service that is to have exportable functions,
three versions of the service are created.  The first is the interface
of the service.  For example if we want to have an exportable service
<tt>HsFoo</tt>, the interface will exist
<tt>haystack.service.HsFoo</tt>.  The implementation that does
all the work will exist in <tt>haystack.service.real.HsFoo</tt>.
The ``stub'' (or skeleton) implementation exists in
<tt>haystack.service.virtual.HsFoo</tt>.
<P>
When the ``root'' <tt>HaystackRootServer</tt> is created it will load
a copy of the <tt>real.HsFoo</tt> service and a
<tt>MiddlemanServer</tt>.  Figure&nbsp;<A HREF="node73.html#figmiddleman"><IMG  ALIGN=BOTTOM ALT="gif" SRC="cross_ref_motif.gif"></A> describes a
simplified interaction between a service <em>A</em> running in a
non-root VM with HsFoo.
<P>
<P><A NAME="1748">&#160;</A><A NAME="figmiddleman">&#160;</A> <IMG ALIGN=BOTTOM ALT="figure1745" SRC="middleman.gif"  > <BR>
<STRONG>Figure:</STRONG> Abstract inter-service communication model<BR>
<P>
<P>
<UL><LI> In step A of the interaction, the <tt>real.HsFoo</tt> service
  registers itself with the <tt>HsNameService</tt>.  At the same time,
  the <tt>HsNameService</tt> running in the context of the second
  <tt>HaystackRootServer</tt> connects to the ``root''
  <tt>HsNameService</tt> by means of a <tt>Middleman</tt> service.
  <tt>Middleman</tt> interaction involve the setting up of TCP socket
  over which serialized Java objects are passed (i.e we convert Java
  objects into a byte stream, send it over the TCP connection, and
  reassemble the bytes into the Java object on the other end).<LI> In step B, Service <em>A</em> asks it's local
  <tt>HsNameService</tt> for a pointer to <tt>HsFoo</tt>.
  <tt>HsNameService</tt>, after deciding that <tt>real.HsFoo</tt>
  object is running in the root <tt>HaystackRootServer</tt>, will
  instantiate a <tt>virtual.HsFoo</tt> object.<LI> The <tt>HsNameService</tt> will pass the pointer to the
  virtual.HsFoo object back to Service <em>A</em> in step C.<LI> In step B, Service <em>A</em> can now call the functions of
  <tt>virtual.HsFoo</tt> just as it would when communicating with the
  <tt>real.HsFoo</tt> object.  The <tt>virtual.HsFoo</tt> object will
  then pass the method name and arguments it receives to the
  <tt>Middleman</tt> which in turn will pass the arguments to the
  <tt>MiddlemanServer</tt>, and these get applied to the
  <tt>real.HsFoo</tt> objet.  The results are passed in the reverse
  direction.
</UL>
<P>
The actual model for the <tt>Middleman</tt> is much more complex and
allows for multiple connections between VMs and a more complex method
for passing ``packets'' between the VMs.
<P>
<HR><A NAME="tex2html1104" HREF="node74.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html1102" HREF="node72.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html1096" HREF="node72.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html1106" HREF="node2.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A>  <BR>
<B> Next:</B> <A NAME="tex2html1105" HREF="node74.html">The HsCommandAPI Service</A>
<B>Up:</B> <A NAME="tex2html1103" HREF="node72.html">The Interface Services</A>
<B> Previous:</B> <A NAME="tex2html1097" HREF="node72.html">The Interface Services</A>
<P><ADDRESS>
Copyright 1998, Eytan Adar (eytan@alum.mit.edu)
</ADDRESS>
</BODY>
</HTML>
